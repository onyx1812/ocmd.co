"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var wfocuCommons={hooks:{action:{},filter:{}},addAction:function(t,e,a,i){this.addHook("action",t,e,a,i)},addFilter:function(t,e,a,i){this.addHook("filter",t,e,a,i)},doAction:function(t){this.doHook("action",t,arguments)},applyFilters:function(t){return this.doHook("filter",t,arguments)},removeAction:function(t,e){this.removeHook("action",t,e)},removeFilter:function(t,e,a){this.removeHook("filter",t,e,a)},addHook:function(t,e,a,i,s){null==this.hooks[t][e]&&(this.hooks[t][e]=[]);var o=this.hooks[t][e];null==s&&(s=e+"_"+o.length),null==i&&(i=10),this.hooks[t][e].push({tag:s,callable:a,priority:i})},doHook:function(t,e,a){if(a=Array.prototype.slice.call(a,1),null!=this.hooks[t][e]){var i,s=this.hooks[t][e];s.sort(function(t,e){return t.priority-e.priority});for(var o=0;o<s.length;o++)"function"!=typeof(i=s[o].callable)&&(i=window[i]),"action"==t?i.apply(null,a):a[0]=i.apply(null,a)}if("filter"==t)return a[0]},removeHook:function(t,e,a,i){if(null!=this.hooks[t][e])for(var s=this.hooks[t][e],o=s.length-1;0<=o;o--)null!=i&&i!=s[o].tag||null!=a&&a!=s[o].priority||s.splice(o,1)},parseURL:function(t){var e,a,i,s=document.createElement("a"),o={};for(s.href=t,e=s.search.replace(/^\?/,"").split("&"),i=0;i<e.length;i++)o[(a=e[i].split("="))[0]]=a[1];return{protocol:s.protocol,host:s.host,hostname:s.hostname,port:s.port,pathname:s.pathname,search:s.search,searchObject:o,hash:s.hash}},wfab_deparam1:function(t){for(var e=t.split("&"),a={},i=0;i<e.length;i++){var s=e[i].split("="),o=decodeURIComponent(s[0]),r=decodeURIComponent(s[1]),s=o.match(/(^[^\[]+)(\[.*\]$)?/),o=s[1];(s=s[2]?s[2].match(/(?=\[(.*)\]$)/)[1].split("]["):[]).unshift(o),function(t,e,a){var i;1<e.length?(void 0===t[i=e.shift()]&&(t[i]=""==e[0]?[]:{}),arguments.callee(t[i],e,a)):t instanceof Array?t.push(a):t[e]=a}(a,s,r)}return a}};!function(g){var w={ViewsRegistered:!1,items:[],itemsData:[],itemsPrices:[],itemsTaxes:[],itemsDataDisplay:[],shippingCost:0,shippingOptions:[],shippingPreference:null,ShippingRaw:[],globalVars:window.wfocu_vars,ShippingFlatApplied:{},ShippingCall:null,shippingTax:0,inOfferTransaction:!1,inOfferTransactionData:{},sendStatus:!1,isSending:!1,addItem:function(t,e,a,i){void 0===a&&(a=[]),this.items.push(t),!1===i?this.itemsTaxes.push(this.getTaxInfo(t)):this.itemsTaxes.push(i),this.itemsData.push(a),this.itemsDataDisplay.push(this.prepareDisplay(a,t)),this.needsDynamicShipping(t)?(this.resetShipping(),this.processShipping()):this.needsFlatShipping(t)&&(this.resetShipping(),this.applyFlatShipping()),this.itemsPrices.push(e)},validateBeforeAddItem:function(t,e,a){var i;if(""===a){if(void 0===this.globalVars.offer_data.products[t])return!1;if("variable"===this.globalVars.offer_data.products[t].type)return!1;if(!0===this.globalVars.offer_data.products[t].backorders_allowed)return!0;if(-1===(s=parseInt(this.globalVars.offer_data.products[t].max_qty)))return!0;if(i=parseInt(this.globalVars.offer_data.products[t].quantity),s<this.getQuantity(t)+i)return!1}else{if(void 0===this.globalVars.offer_data.products[t])return!1;var s,o=g('.wfocu_variation_selector_wrap[data-key="'+t+'"]').attr("data-variations-stock");if(-1===(s=JSON.parse(o)[a]))return!0;if(null===s)return!0;if(s=parseInt(s),i=parseInt(this.globalVars.offer_data.products[t].quantity),s<this.getQuantity(t,a)+i)return!1}return!0},getQuantity:function(t,e){var a=0;if(void 0===e)for(var i in o=this.getItems())o[i]===t&&a++;else{var s,o,r=this.getItemsData();for(s in o=this.getItems())if(o[s]===t)for(var n in r[s]){var c=r[s][n];/_wfocu_variation=/i.test(c)&&e===c.slice(17,c.length)&&a++}}return parseInt(this.globalVars.offer_data.products[t].quantity)*a},getItemDataByIndex:function(t,a){var t=this.itemsData[t],i="";return g.each(t,function(t,e){e=e.split("=");a===e[0]&&(i=e[1])}),i},DisableButtonState:function(t){var e=g(".wfocu_upsell");void 0!==t&&(e=g('.wfocu_upsell[data-key="'+t+'"]')),e.addClass("disabled")},EnableButtonState:function(t){var e=g(".wfocu_upsell");void 0!==t&&(e=g('.wfocu_upsell[data-key="'+t+'"]')),e.removeClass("disabled")},removeItem:function(t){var e=this.items[t];this.items.splice(t,1),this.itemsData.splice(t,1),this.itemsTaxes.splice(t,1),this.itemsDataDisplay.splice(t,1),this.itemsPrices.splice(t,1),this.needsDynamicShipping(e)?(this.resetShipping(),this.processShipping()):this.needsFlatShipping(e)&&(this.resetShipping(),this.applyFlatShipping())},clean:function(){this.items=[],this.itemsData=[],this.itemsPrices=[],this.itemsTaxes=[],this.itemsDataDisplay=[],this.shippingCost=0,this.shippingOptions=[],this.ShippingRaw=[],this.ShippingFlatApplied={},this.shippingTax=0},getItems:function(){return this.items},getItemsData:function(){return this.itemsData},getItemsPrices:function(){return this.itemsPrices},getItemsQty:function(t){return parseInt(this.globalVars.offer_data.products[t].quantity)},getItemsDataDislay:function(){return this.itemsDataDisplay},getItemDisplayPrice:function(t){var e=this.itemsPrices[t],t=this.itemsTaxes[t];return!0===this.globalVars.global.include_taxes&&!0===this.globalVars.offer_data.is_show_confirmation?e:e+t},getSubtotalPrice:function(){var t=this.sum(this.getItemsPrices()),e=this.sum(this.itemsTaxes);return!0===this.globalVars.global.include_taxes&&!0===this.globalVars.offer_data.is_show_confirmation?t:t+e},MaybeAddShipping:function(t,e,a){if(""===a){var i,s=this.getShippingByKey(t);if(!1===s)return;if(!1===w.isEmpty(s.shipping))for(var o in w.ShippingRaw.push(s.shipping),s.shipping)!1!==(i=w.getShippingDifference(s.shipping[o],s.shipping_prev))&&w.shippingOptions.push({label:w.getShippingLabel(s.shipping[o]),value:o,diff:i,selected:""});else if(!1===w.isEmpty(s.free_shipping))for(var r in w.ShippingRaw.push(s.free_shipping),s.free_shipping)i=w.getShippingDifference(s.free_shipping[r],s.shipping_prev),!0===w.isFloatOrNum(i)&&w.shippingOptions.push({label:w.getShippingLabel(s.free_shipping[r]),value:r,diff:i,selected:""})}else _.has(m.shippingCharges,a)&&w.shippingOptions.push({label:m.shippingCharges[a].label,value:m.shippingCharges[a].method,diff:{cost:m.shippingCharges[a].cost,tax:m.shippingCharges[a].tax},selected:""});0<w.shippingOptions.length&&(w.shippingOptions[0].selected="checked",w.setShipping(parseFloat(w.shippingOptions[0].diff.cost)),w.setShippingTax(parseFloat(w.shippingOptions[0].diff.tax)))},getShippingByKey:function(t){return void 0!==this.globalVars.offer_data.products[t]&&(void 0!==this.globalVars.offer_data.products[t].shipping&&this.globalVars.offer_data.products[t].shipping)},applyFlatShipping:function(){var t,e=[],a=[],i=[];for(t in this.items)this.globalVars.offer_data.products[this.items[t]].needs_shipping&&"flat"===this.shippingPreference&&0<this.globalVars.offer_data.products[this.items[t]].shipping_cost_flat&&-1===i.indexOf(this.items[t])&&(e.push(this.globalVars.offer_data.products[this.items[t]].shipping_cost_flat),a.push(this.globalVars.offer_data.products[this.items[t]].shipping_cost_flat_tax),i.push(this.items[t]));0<i.length&&(w.shippingOptions.push({label:w.globalVars.global.flat_shipping_label,value:"fixed",diff:{cost:this.sum(e),tax:this.sum(a)},selected:""}),w.shippingOptions[0].selected="checked",w.setShipping(parseFloat(w.shippingOptions[0].diff.cost)),w.setShippingTax(parseFloat(w.shippingOptions[0].diff.tax)))},getShippingFlatByKey:function(t){return void 0!==this.globalVars.offer_data.products[t]&&(void 0!==this.globalVars.offer_data.products[t].shipping_cost_flat&&{cost:this.globalVars.offer_data.products[t].shipping_cost_flat,tax:this.globalVars.offer_data.products[t].shipping_cost_flat_tax})},resetShipping:function(){this.shippingCost=0,this.ShippingRaw=[],this.shippingOptions=[]},prepareDisplay:function(t,i){if(0===t.length)return t;var s=[];return g.each(t,function(t,e){var a=e.split("=");"_"!==a[0].charAt(0)&&(e=a[1].replace(/\+/g," "),e=m.OptionsHtml[i][a[0]][e],_.isUndefined(e)||s.push({title:w.getDataTitle(a[0]),val:e.innerText}))}),s},getTaxInfo:function(t){return void 0===this.globalVars.offer_data.products[t]||void 0===this.globalVars.offer_data.products[t].tax?0:this.globalVars.offer_data.products[t].tax},needsFlatShipping:function(t){return!1===this.globalVars.is_free_shipping&&!0===this.globalVars.offer_data.products[t].needs_shipping&&"flat"===this.globalVars.offer_data.shipping_preferece},needsDynamicShipping:function(t){return!1===this.globalVars.is_free_shipping&&!0===this.globalVars.offer_data.products[t].needs_shipping&&"dynamic"===this.globalVars.offer_data.shipping_preferece},getItemsNeedDynamicShipping:function(){var a=[];return g(this.getItems()).each(function(t,e){w.needsDynamicShipping(e)&&a.push(e)}),a},processShipping:function(){var t=this.getItemsNeedDynamicShipping();0!==t.length?this.ShippingCall=g.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_calculate_shipping"),data:{action:"wfocu_front_calculate_shipping",nonce:this.globalVars.nonces.wfocu_calculate_shipping,"wfocu-si":this.globalVars.session_id,items:t,itemsData:this.getItemsData()},beforeSend:function(){w.initiateLoader(),null!==w.ShippingCall&&w.ShippingCall.abort()},success:function(t){var e;if(w.clearLoader(),_.has(t,"success")){var a=!1;void 0!==t.data.override&&(a=t.data.override);var i=[];if(!1===w.isEmpty(t.data.free_shipping))for(var s in w.ShippingRaw.push(t.data.free_shipping),t.data.free_shipping)!1!==(e=w.getShippingDifference(t.data.free_shipping[s],t.data.shipping_prev))&&(i.push(s),w.shippingOptions.push({label:w.getShippingLabel(t.data.free_shipping[s]),value:s,diff:e,selected:"",tax:0}));if(!1===w.isEmpty(t.data.shipping)){for(var o in t.data.shipping)for(var r in t.data.shipping[o])-1===_.indexOf(i,r)&&(a&&(t.data.shipping_prev.cost=0),!1!==(e=w.getShippingDifference(t.data.shipping[o][r],t.data.shipping_prev))&&w.shippingOptions.push({label:w.getShippingLabel(t.data.shipping[o][r]),value:r,diff:e,selected:"",override:a}));w.ShippingRaw.push(t.data.shipping)}0<w.shippingOptions.length&&(w.shippingOptions[0].selected="checked",w.setShipping(parseFloat(w.shippingOptions[0].diff.cost)),w.setShippingTax(parseFloat(w.shippingOptions[0].diff.tax))),!w.doShow()&&"hold"===w.sendStatus?w.sendBucket():w.render()}else w.render();w.ShippingCall=null}}):w.render()},getShippingLabel:function(t){return t.label},getShippingDifference:function(t,e,a){void 0===a&&(a=!0);var i=parseFloat(t.cost)+parseFloat(t.shipping_tax),s=parseFloat(e.cost)+parseFloat(e.tax),i=this.unformatPrices(i-parseFloat(s)),s=this.PreCalculateTotalForShipping(i);if(a&&s<=0)return!1;e=this.unformatPrices(t.shipping_tax)-this.unformatPrices(e.tax);return{cost:i-e,tax:e}},getShippingPrintDiff:function(a){var i=0;return g(this.shippingOptions).each(function(t,e){e.value===a&&(i=e.diff.cost,!1===w.globalVars.global.include_taxes&&(i+=e.diff.tax))}),i},isFloatOrNum:function(t){var e=Number(t)===t&&t%1!=0,t=Number(t)===t&&t%1==0;return e||t},isEmpty:function(t){for(var e in t)if(_.has(t,e))return!1;return!0},getDataTitle:function(t){return 0<g('select[data-attribute_name="'+t+'"]').length?g('select[data-attribute_name="'+t+'"]').parent("td").eq(0).attr("data-attribute-title"):t},doShow:function(){return this.globalVars.offer_data.is_show_confirmation},render:function(){var t=g(".wfocu-cart-components"),e=window.wp.template("wfocu-bucket-template");t.html(e({Bucket:w})).promise().done(function(){w.reveal(),w.bindHandlers(),g(document).trigger("wfocuBucketConfirmationRendered",[w])})},sum:function(t){return t.reduce(function(t,e){return t+e},0)},PreCalculateTotalForShipping:function(t){var e=this.sum(this.getItemsPrices()),a=this.getTaxTotal();return parseFloat(e)+a+parseFloat(t)},getTaxTotal:function(){var t=this.sum(this.itemsTaxes),e=this.shippingTax;return parseFloat(t)+e},getTotal:function(){return parseFloat(this.sum(this.getItemsPrices()))+this.getTaxTotal()+this.shippingCost},reveal:function(){jQuery("body").addClass("wfocu-sidecart-open")},hide:function(){jQuery("body").hasClass("wfocu-sidecart-open")&&(jQuery("body").removeClass("wfocu-sidecart-open"),jQuery(".wfocu-offer-btn-wrap").removeClass("wfocu-def-hide")),0===w.getItems().length&&jQuery(".wfocu-offer-btn-wrap").addClass("wfocu-def-hide")},initiateLoader:function(){jQuery(".wfocu-sidebar-cart .wfocu-cart-components").addClass("wfocu-loading"),jQuery(".wfocu-sidebar-cart .wfocu-mc-close").addClass("wfocu-disable-close")},clearLoader:function(){jQuery(".wfocu-sidebar-cart .wfocu-cart-components").removeClass("wfocu-loading"),jQuery(".wfocu-sidebar-cart .wfocu-mc-close").removeClass("wfocu-disable-close")},init:function(){this.placeOverlay(),!0!==this.globalVars.is_preview&&(this.prepareActionLinks(),this.bindBaseHandlers(),this.shippingPreference=this.globalVars.offer_data.shipping_preferece,this.bindHandlers(),this.hideOutOfStockLinks(),w.updateViews(),g(document).trigger("wfocuBucketCreated",[this]))},bindBaseHandlers:function(){g(document).on("click",".wfocu-black-overlay",function(){!1===g(".wfocu-sidebar-cart .wfocu-cart-components").hasClass("wfocu-loading")&&w.hide()}),g("body").on("click",".wfocu-confirm-order-btn",function(){return w.render(),!1}),g(".wfocu_upsell").on("click",function(){var t=w.globalVars.offer_data.is_show_confirmation,e=g(this).data("key"),a=[],i=w.getPriceByKey(e),s=!1,o="",r=g('.wfocu-select-qty-input[data-key="'+e+'"]').val();if(void 0===r&&(r=1),"complete"===document.readyState){if(0<g('form.wfocu_variation_selector_form[data-key="'+g(this).data("key")+'"]').length){if(g(this).hasClass("disabled")){var n=g('form.wfocu_variation_selector_form[data-key="'+g(this).data("key")+'"]').eq(0);return g("html, body").stop().animate({scrollTop:n.offset().top-100},1e3,"swing",function(){}),alert(w.globalVars.messages.i18n_no_matching_variations_text),!1}o=g('form.wfocu_variation_selector_form[data-key="'+g(this).data("key")+'"] input[name="_wfocu_variation"]').val();var c=g('form.wfocu_variation_selector_form[data-key="'+g(this).data("key")+'"]').eq(0).serialize(),n=g('form.wfocu_variation_selector_form[data-key="'+g(this).data("key")+'"] .wfocu_variation_selector_wrap').attr("data-prices");(n=JSON.parse(n))[o]&&(i=n[o].price_excl_tax,s=n[o].price_incl_tax-n[o].price_excl_tax);var p,l=wfocuCommons.wfab_deparam1(c);for(p in l)a.push(p+"="+l[p])}if(0<g('form.wfocu_attributes_selector_form[data-key="'+g(this).data("key")+'"]').length){if(g(this).hasClass("disabled")){var f=g('form.wfocu_attributes_selector_form[data-key="'+g(this).data("key")+'"]').eq(0);return g("html, body").stop().animate({scrollTop:f.offset().top-100},1e3,"swing",function(){}),alert(w.globalVars.messages.i18n_no_matching_variations_text),!1}a=""!==(a=g('form.wfocu_attributes_selector_form[data-key="'+g(this).data("key")+'"]').eq(0).serialize())?a.split("&"):[]}if(g(this).hasClass("disabled"))return!1;f=w.validateBeforeAddItem(e,a,o),i=wfocuCommons.applyFilters("wfocu_additem_price",i,e,o),s=wfocuCommons.applyFilters("wfocu_additem_taxes",s,e,o),a=wfocuCommons.applyFilters("wfocu_additem_data",a,e,o);if(!1===f)return alert(w.globalVars.messages.i18n_no_matching_variations_text),!1;if(!1!==t){for(var u=0;u<r;u++)w.addItem(e,i,a,s);return w.render(),!1}w.clean();for(var h=0;h<r;h++)w.addItem(e,i,a,s);w.sendBucket()}}),g("body").on("click",".wfocu_skip_offer",function(){w.skip(this)})},bindHandlers:function(){g(".wfocu_remove_item").click(function(){var t=g(this).attr("data-index");"number"==typeof parseInt(t)&&(w.removeItem(t),w.render())}),g(".wfocu-mc-close a").on("click",function(){w.hide()}),g(".wfocu-mc-button").click(function(){try{w.sendBucket()}catch(t){console.log(t)}}),g('.wfocu_ship_selector input[type="radio"]').change(function(){var t,e=g(this).val();for(t in w.shippingOptions)e===w.shippingOptions[t].value?(w.shippingOptions[t].selected="checked",w.setShipping(parseFloat(w.shippingOptions[t].diff.cost)),w.setShippingTax(parseFloat(w.shippingOptions[t].diff.tax))):w.shippingOptions[t].selected="";w.render()}),g(".wfocu_skip_offer_mc").click(function(){w.skip(this)}),g("select.wfocu-select-qty-input").on("change",function(){var t=g(this),e=t.attr("data-key");g('.wfocu-select-qty-input[data-key="'+e+'"]').val(t.val())})},updateViews:function(){if(!0!==this.ViewsRegistered&&"1"!==this.localStorage.get("wfocu_"+this.globalVars.offer+"_"+this.globalVars.session_id)){var t,e={};for(t in this.globalVars.offer_data.products)e[t]={id:this.globalVars.offer_data.products[t].id,name:this.globalVars.offer_data.products[t].name};g.post(this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_register_views"),{action:"wfocu_front_register_views","wfocu-si":this.globalVars.session_id,nonce:this.globalVars.nonces.wfocu_register_views,data:{offer_type:this.globalVars.offer_type,offer_type_index:this.globalVars.offer_type_index,products:e}},function(){w.localStorage.set("wfocu_"+w.globalVars.offer+"_"+w.globalVars.session_id,"1")}),this.ViewsRegistered=!0}},getChosenShipping:function(){if(0===this.shippingOptions.length)return null;var a=null;return g(this.shippingOptions).each(function(t,e){"checked"===e.selected&&(a=e)}),a},HandleResponse:function(t){var e=1e3;Object.prototype.hasOwnProperty.call(t,"success")&&!0===t.success?w.swal.show({text:wfocu_vars.messages.offer_success_message_pop,type:"success"}):Object.prototype.hasOwnProperty.call(t,"success")&&"onhold"===t.success?wfocuSweetalert2.getContent().querySelector("#wfocuswal-content #wfocu-swal-content").textContent=t.message:(e=1500,w.swal.show({text:wfocu_vars.messages.offer_msg_pop_failure,type:"warning"})),setTimeout(function(){void 0!==t.data&&void 0!==t.data.redirect_url?window.location=t.data.redirect_url:window.location=wfocu_vars.order_received_url},e)},ShowLoading:function(){this.swal.show(wfocu_vars.loader)},skip:function(t){try{g(t).prop("disable",!0),g(t).prop("disabled",!0),w.swal.show(this.globalVars.loader),g.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_offer_skipped"),data:{action:"wfocu_front_offer_skipped",nonce:this.globalVars.nonces.wfocu_front_offer_skipped,data:{offer_type:this.globalVars.offer_type,offer_type_index:this.globalVars.offer_type_index},"wfocu-si":this.globalVars.session_id},success:function(t){_.has(t,"success")&&(window.location=t.data.redirect_url)},error:function(t){void 0!==window.wfocu_vars.order_received_url&&(window.location=window.wfocu_vars.order_received_url+"&ec="+t.status)}})}catch(t){g.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_catch_error"),data:{action:"wfocu_front_catch_error",nonce:this.globalVars.nonces.wfocu_front_catch_error,message:t,"wfocu-si":this.globalVars.session_id}}),void 0!==w.globalVars.order_received_url&&(window.location=w.globalVars.order_received_url+"&ec="+t)}},getBucketSendData:function(){return wfocuCommons.applyFilters("wfocu_front_charge_data",{action:"wfocu_front_charge",nonce:this.globalVars.nonces.wfocu_charge,"wfocu-si":this.globalVars.session_id,items:this.getItems(),itemsData:this.getItemsData(),shipping:this.getChosenShipping(),totals:{itemsPrices:this.unformatPrices(this.getItemsPrices()),taxTotal:this.unformatPrices(this.getTaxTotal()),total:this.unformatPrices(this.getTotal())}})},sendBucket:function(){try{0===this.getItems().length&&this.handleSendBucketException("no items in the bucket");var t=this.getBucketSendData();if(!1===wfocuSweetalert2.isVisible()&&w.swal.show(this.globalVars.loader+'</br> <div id="wfocu-swal-content">'+this.globalVars.loading_text+"</div>"),0<w.getItemsNeedDynamicShipping().length&&!1===w.doShow()&&!1===w.sendStatus)return void(w.sendStatus="hold");if(g(document).trigger("wfocu_external",[w,t]),!0===w.inOfferTransaction)return;if(!0===w.isSending)return;w.isSending=!0,g.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_charge"),data:t,success:function(t){var e=1e3;w.isSending=!1,_.has(t,"success")?(e=1e3,!0===t.success?w.swal.show({text:window.wfocu_vars.messages.offer_success_message_pop,type:"success"}):"onhold"===t.success?wfocuSweetalert2.getContent().querySelector("#wfocuswal-content #wfocu-swal-content").textContent=t.message:(e=1500,w.swal.show({text:window.wfocu_vars.messages.offer_msg_pop_failure,type:"warning"}))):_.has(t,"result")&&"error"===t.result?(e=1500,w.swal.show({text:window.wfocu_vars.messages.offer_msg_pop_failure,type:"warning"})):void 0!==window.wfocu_vars.order_received_url&&(window.location=window.wfocu_vars.order_received_url),setTimeout(function(){void 0!==t.data&&void 0!==t.data.redirect_url?window.location=t.data.redirect_url:window.location=window.wfocu_vars.order_received_url},e)},error:function(t){w.isSending=!1,void 0!==window.wfocu_vars.order_received_url&&(t=t.status,window.location=w.globalVars.order_received_url+"&ec="+t)}})}catch(t){this.handleSendBucketException(t)}},handleSendBucketException:function(t){g.ajax({type:"POST",url:this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_catch_error"),data:{action:"wfocu_front_catch_error",nonce:this.globalVars.nonces.wfocu_front_catch_error,message:t,"wfocu-si":this.globalVars.session_id}}),void 0!==w.globalVars.order_received_url&&(window.location=w.globalVars.order_received_url+"&ec="+t)},setShipping:function(t){this.shippingCost=t},setShippingTax:function(t){this.shippingTax=t},getShipping:function(){return this.shippingCost},getKeyBYIndex:function(t){var e=_.allKeys(wfocu_vars.offer_data.fields);return _.isUndefined(e[t-1])?t:e[t-1]},convertLinksYes:function(t,e){var a=t.attr("href").substring(1);w.isValidKey(a)||(""===a&&(a=1),a=this.getKeyBYIndex(a)),w.isValidKey(a)&&(t.attr("href","javascript:void(0);"),t.attr("data-key",a),t.addClass("wfocu_upsell"),!1===w.globalVars.offer_data.settings.ask_confirmation&&t.addClass("wfocu_paypal_in_context_btn"),t.removeClass("wfocu_yes_btn"),g(e).removeClass("wfocu_yes_btn"))},convertLinksNo:function(t,e){t.attr("href","javascript:void(0);"),t.addClass("wfocu_skip_offer"),t.removeClass("wfocu_no_btn"),g(e).removeClass("wfocu_no_btn")},prepareActionLinks:function(){g('a[href*="wfocu-accept-link=yes"]').each(function(t,e){g(this).addClass("wfocu_yes_btn");var a=g(this).attr("href"),a=wfocuCommons.parseURL(a);_.isObject(a)&&_.has(a,"searchObject")&&_.isObject(a.searchObject)&&_.has(a.searchObject,"key")?g(this).attr("href","#"+a.searchObject.key):g(this).attr("href","")}),g('a[href*="wfocu-reject-link=yes"]').each(function(t,e){g(this).addClass("wfocu_no_btn"),g(this).attr("href","")}),g(".wfocu_yes_btn").each(function(t,e){var a,i=e;"A"===e.tagName?(a=g(e),w.convertLinksYes(a,i)):0<g(e).find("a").length&&g(e).find("a").each(function(t,e){e=g(e);0<e.length&&w.convertLinksYes(e,i)})}),g(".wfocu_no_btn").each(function(t,e){var a,i=e;"A"===e.tagName?(a=g(e),w.convertLinksNo(a,i)):0<g(e).find("a").length&&g(e).find("a").each(function(t,e){e=g(e);0<e.length&&w.convertLinksNo(e,i)})}),g(document).trigger("wfocuBucketLinksConverted",[w])},isValidKey:function(t){return void 0!==this.globalVars.offer_data.products[t]},placeOverlay:function(){var t;0===g(".wfocu-offer-btn-wrap").length&&0<g("#tmpl-wfocu-body-next-template").length&&(t=window.wp.template("wfocu-body-next-template"),g("body").prepend(t({})))},getPriceByKey:function(t){return void 0===this.globalVars.offer_data.products[t]||void 0===this.globalVars.offer_data.products[t].price?0:this.globalVars.offer_data.products[t].sale_price_excl_tax},hideOutOfStockLinks:function(){for(var t in this.globalVars.offer_data.products)_.has(this.globalVars.offer_data.products[t],"is_in_stock")&&(this.globalVars.offer_data.products[t].is_purchasable&&this.globalVars.offer_data.products[t].is_in_stock||w.DisableButtonState(t),!1===this.globalVars.offer_data.products[t].backorders_allowed&&-1!==this.globalVars.offer_data.products[t].max_qty&&this.globalVars.offer_data.products[t].max_qty<parseInt(this.globalVars.offer_data.products[t].quantity)&&w.DisableButtonState(t))},formatMoney:function(t){return accounting.formatMoney(t,{symbol:wfocu_wc_params.currency_format_symbol,decimal:wfocu_wc_params.currency_format_decimal_sep,thousand:wfocu_wc_params.currency_format_thousand_sep,precision:wfocu_wc_params.currency_format_num_decimals,format:wfocu_wc_params.currency_format})},formatPrice:function(t,e,a,i){return void 0===e&&(e=wfocu_wc_params.currency_format_num_decimals),void 0===a&&(a=wfocu_wc_params.currency_format_thousand_sep),void 0===i&&(i=wfocu_wc_params.currency_format_decimal_sep),parseFloat(accounting.formatNumber(t,e,a,i))},unformatPrices:function(t){if("object"!==_typeof(t))return accounting.toFixed(accounting.unformat(t),2);var e,a=[];for(e in t)a.push(accounting.toFixed(accounting.unformat(t[e]),2));return a},expire:function(){g.post(this.globalVars.wc_ajax_url.toString().replace("%%endpoint%%","wfocu_front_offer_expired"),{action:"wfocu_front_offer_expired",nonce:this.globalVars.nonces.wfocu_offer_expired,"wfocu-si":this.globalVars.session_id},function(t){_.has(t,"success")&&(window.location=t.data.redirect_url)})},swal:{current:null,show:function(t){wfocuSweetalert2.isVisible()&&wfocuSweetalert2.close();var e={showCancelButton:!1,showConfirmButton:!1,allowOutsideClick:!1};"string"==typeof t?wfocuSweetalert2(g.extend(e,{html:t})):wfocuSweetalert2(g.extend(e,t))},hide:function(){wfocuSweetalert2.close()}},localStorage:{get:function(t){try{return localStorage.getItem(t)}catch(t){return!1}},set:function(t,e){try{return localStorage.setItem(t,e),!0}catch(t){return!1}}}};w.init();var m={snapshots:{},allOptions:{},anyAttributes:{},chosenVariations:{},shippingCharges:{},ShippingCallVariation:null,handlersAttached:[],OptionsHtml:{},init:function(){g(".wfocu_variation_selector_wrap").each(function(){var t=g(this).attr("data-key"),e=g(this).attr("data-variations"),a=g(this).attr("data-default");try{e=JSON.parse(e),m.snapshots[t]=defiant.getSnapshot(e),m.getAllAttributesNames(t),m.populateDropDowns(t);var i=m.query(t,'//*[@d:name="'+a+'"]');m.setUpDefault(t,i),-1===m.handlersAttached.indexOf(t)&&(m.attachHandlers(t),m.handlersAttached.push(t))}catch(t){console.error(t)}})},getAllAttributesNames:function(e){void 0===m.allOptions[e]&&(this.allOptions[e]={},m.OptionsHtml[e]={},g('.wfocu_variation_selector_wrap[data-key="'+e+'"] select').each(function(){var t=g(this).attr("name");m.allOptions[e][t]={},m.OptionsHtml[e][t]={},g(this).find("option").each(function(){m.OptionsHtml[e][t][g(this).attr("value")]=this,m.allOptions[e][t][g(this).attr("value")]=this.innerText})}))},populateDropDowns:function(a){this.anyAttributes[a]=[],g('.wfocu_variation_selector_wrap[data-key="'+a+'"] select').each(function(){var t=g(this).attr("name"),e=m.query(a,"//@"+t);""===e[0]&&m.anyAttributes[a].push(t);t=m.createOptions(e,t,a);t&&g(this).html(t.innerHTML)})},setUpDefault:function(e,a){g('.wfocu_variation_selector_wrap[data-key="'+e+'"] select').each(function(){var t=g(this).attr("name");m.isAttributeAny(e,t)||(t=a[0]["@"+t],!0===window.wfocu_vars.show_variation_default&&g(this).val(t).prop(t))});var t,i,s=w.globalVars.offer_data.products[e].variations_data.default,o=g('.wfocu_variation_selector_wrap[data-key="'+e+'"]').attr("data-shipping-hash"),r=JSON.parse(o),n=_.has(r,s)?r[s]:"",c=[];for(t in r)n===r[t]&&c.push(t);if(0<g(".shop_attributes td.product_weight").length&&(i=g('.wfocu_variation_selector_wrap[data-key="'+e+'"]').attr("data-weight-html"),i=JSON.parse(i),g(".shop_attributes td.product_weight").html(i[s])),0<g(".shop_attributes td.product_dimensions").length&&(i=g('.wfocu_variation_selector_wrap[data-key="'+e+'"]').attr("data-dimensions"),i=JSON.parse(i),g(".shop_attributes td.product_dimensions").html(i[s])),!0===w.globalVars.offer_data.products[e].needs_shipping&&_.has(w.globalVars.offer_data.products[e],"shipping"))if(w.isEmpty(w.globalVars.offer_data.products[e].shipping.shipping)&&w.isEmpty(w.globalVars.offer_data.products[e].shipping.free_shipping))for(var p in c)m.shippingCharges[c[p]]={cost:0,tax:0,method:"",label:""};else if(!1===w.isEmpty(w.globalVars.offer_data.products[e].shipping.shipping))for(var l in w.globalVars.offer_data.products[e].shipping.shipping){var f=w.getShippingDifference(w.globalVars.offer_data.products[e].shipping.shipping[l],w.globalVars.offer_data.products[e].shipping.shipping_prev,!1);if(!1!==f)for(var u in c)m.shippingCharges[c[u]]={cost:f.cost,tax:f.tax,method:l,label:w.globalVars.offer_data.products[e].shipping.shipping[l].label}}else if(!1===w.isEmpty(w.globalVars.offer_data.products[e].shipping.free_shipping))for(var h in w.globalVars.offer_data.products[e].shipping.free_shipping)for(var d in c)m.shippingCharges[c[d]]={cost:0,tax:0,method:h,label:w.globalVars.offer_data.products[e].shipping.free_shipping[h].label};g(document).trigger("wfocu_variation_selected",[e,s])},getOptionName:function(t,e,a){return void 0===m.allOptions[t]||void 0===m.allOptions[t][e]||void 0===m.allOptions[t][e][a]?"":m.allOptions[t][e][a]},unique:function(t){return t.filter(function(t,e,a){return e===a.indexOf(t)})},createOptions:function(t,e,a){if(this.isAttributeAny(a,e))return g('.wfocu_variation_selector_wrap[data-key="'+a+'"] select[name="'+e+'"] option[value=""]').remove(),g('.wfocu_variation_selector_wrap[data-key="'+a+'"] select[name="'+e+'"]').get(0).selectedIndex=0,"";var i,s=this.unique(t),o=document.createElement("select");for(i in!0!==window.wfocu_vars.show_variation_default&&((t=document.createElement("option")).value="-1",t.innerText=window.wfocu_vars.no_variation_text,o.appendChild(t)),s){var r=m.OptionsHtml[a][e][s[i]];o.appendChild(r)}return o},isAttributeAny:function(t,e){return void 0!==m.anyAttributes[t]&&-1<m.anyAttributes[t].indexOf(e)},query:function(t,e){t=this.getSnapShot(t);return defiant.json.search(t,e)},getSnapShot:function(t){if(this.snapshots&&_.has(this.snapshots,t))return this.snapshots[t]},preparePrices:function(t,e){_.has(m.shippingCharges,e)||w.globalVars.offer_data.shipping_preferece,this.populatePrices(t,e)},populatePrices:function(t,e){var a,i,s=g('form.wfocu_variation_selector_form[data-key="'+t+'"] .wfocu_variation_selector_wrap').attr("data-prices"),o=0;(s=JSON.parse(s))[e]&&(o=s[e]);var r=o.price_incl_tax_raw,n=o.regular_price_incl_tax_raw;!1===window.wfocu_vars.is_show_price_with_tax&&(r=o.price_excl_tax_raw,n=o.regular_price_excl_tax),a=void 0!==m.shippingCharges[e]?m.shippingCharges[e].cost+m.shippingCharges[e].tax+r:r;o=(i=void 0!==m.shippingCharges[e]?m.shippingCharges[e].cost+m.shippingCharges[e].tax+n:n)-a,r=w.formatPrice((i-a)/i*100,0);g("span.wfocu_variable_price_sale[data-key='"+t+"']").html(w.formatMoney(a)).show();n=window.wfocu_vars.offer_data.products[t].quantity;a!==i?(g("span.wfocu_variable_price_regular[data-key='"+t+"']").html(w.formatMoney(i)),g("span.wfocu_variable_price_regular[data-key='"+t+"']").show()):(g("span.wfocu_variable_price_regular[data-key='"+t+"']").html(w.formatMoney(i)),g("span.wfocu_variable_price_regular[data-key='"+t+"']").not(".wfocu_tags").hide()),g("span.wfocu_variable_price_regular.wfocu_tags[data-key='"+t+"']").html(w.formatMoney(i)),g("span.wfocu_variable_price_save_value[data-key='"+t+"']").html(w.formatMoney(o)),g("span.wfocu_variable_price_save_percentage[data-key='"+t+"']").html(r+"%"),g("span.wfocu_variable_price_save_percentage_combo[data-key='"+t+"']").html(t+w.formatMoney(o)+" ("+r+"%)"),g("span.wfocu_single_unit_price[data-key='"+t+"']").html(w.formatMoney(a/parseInt(n))),g(document).trigger("wfocu_populatePrices",[a,i,t,s,e,w])},attachHandlers:function(t){g('.wfocu_variation_selector_wrap[data-key="'+t+'"] select').each(function(){g(this).on("change",function(){var t=g(this).parents(".wfocu_variation_selector_wrap").eq(0).attr("data-key"),e=g('.wfocu_variation_selector_wrap[data-key="'+t+'"]').find('select[name="'+g(this).attr("name")+'"]').not(g(this));0<e.length&&e.val(g(this).val()),m.processVariationSelection(t)})})},processVariationSelection:function(a){var t,e,i=[];g('.wfocu_variation_selector_wrap[data-key="'+a+'"]:first select').each(function(){var t=g(this).val(),e=g(this).attr("name");m.isAttributeAny(a,e)||i.push("@"+e+"='"+t.replace(/'/g,"\\'")+"'")}),i&&0<i.length&&((t=this.query(a,"//*["+i.join(" and ")+"]"))&&0<t.length?(this.chosenVariations[a]={},this.chosenVariations[a]=t[0].id,g('.wfocu_variation_selector_wrap[data-key="'+a+'"] input[name="_wfocu_variation"]').val(this.chosenVariations[a]),m.preparePrices(a,this.chosenVariations[a]),g(document).trigger("wfocu_variation_selected",[a,this.chosenVariations[a]]),0<g(".shop_attributes td.product_weight").length&&(e=g('.wfocu_variation_selector_wrap[data-key="'+a+'"]').attr("data-weight-html"),e=JSON.parse(e),g(".shop_attributes td.product_weight").html(e[this.chosenVariations[a]])),0<g(".shop_attributes td.product_dimensions").length&&(e=g('.wfocu_variation_selector_wrap[data-key="'+a+'"]').attr("data-dimensions"),e=JSON.parse(e),g(".shop_attributes td.product_dimensions").html(e[this.chosenVariations[a]])),w.EnableButtonState(a)):(w.DisableButtonState(a),g('.wfocu_variation_selector_wrap[data-key="'+a+'"] input[name="_wfocu_variation"]').val("")))}};g(document).ready(function(){m.init()})}(jQuery);